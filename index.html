<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>15m + 1D Max Zone Pump & Dump Detector + Live Sentiment</title>
  <style>
    body { font-family: Inter, sans-serif; background:#0b1120; color:#fff; padding:20px; }
    h1 { color:#38bdf8; }
    .section { margin-top:20px; }
    .pump { color:#22c55e; font-weight:bold; }
    .dump { color:#ef4444; font-weight:bold; }
    .symbol { font-weight:600; }
    .meta { color:#94a3b8; font-size:0.9em; }
    .highlight { background:rgba(56,189,248,0.2); border-left:4px solid #38bdf8; padding:4px 8px; border-radius:8px; }
    #status { margin-top:10px; color:#94a3b8; font-size:0.9em; }
    #status strong { color:#38bdf8; }
    #sentiment { margin-top:12px; font-size:1em; font-weight:600; color:#38bdf8; }
    #sentiment .bull { color:#22c55e; }
    #sentiment .bear { color:#ef4444; }
    h2 { margin-top:15px; }
  </style>
</head>
<body>
  <h1>🧠 Dual-Timeframe Max Zone Pump & Dump Detector</h1>
  <p>Scans Binance Futures (USDT pairs ≥ +3%). Runs both 15m and 1D analyses. Auto-updates every 30 s.</p>

  <div id="status">⏳ Initializing...</div>
  <div id="sentiment">📊 Market Sentiment: Loading...</div>

  <div id="scanner-15m" class="section">
    <h2>🕒 15-Minute Timeframe</h2>
    <h3 class="pump">Max Zone Pump</h3>
    <ul id="pump-15m"></ul>
    <h3 class="dump">Max Zone Dump</h3>
    <ul id="dump-15m"></ul>
  </div>

  <div id="scanner-1d" class="section">
    <h2>📅 1-Day Timeframe</h2>
    <h3 class="pump">Max Zone Pump</h3>
    <ul id="pump-1d"></ul>
    <h3 class="dump">Max Zone Dump</h3>
    <ul id="dump-1d"></ul>
  </div>

  <p id="last-update" style="color:#94a3b8;margin-top:20px;font-size:0.9em;"></p>

  <script>
    const API_URL="https://fapi.binance.com";
    const RSI_PERIOD=14, BATCH_SIZE=3, MIN_DELAY=800, MAX_DELAY=1500, MAX_ITEMS=10;
    const INTERVAL_15M=8000, INTERVAL_1D=15000; // staggered for safety
    const activeSignals15m={}, activeSignals1d={};
    const blacklist=["ALPACAUSDT","BNXUSDT","ALPHAUSDT","OCEANUSDT","DGBUSDT","AGIXUSDT","LINAUSDT","LOKAUSDT","KEYUSDT","MDTUSDT","LOOMUSDT","RENUSDT","OMNIUSDT","SLERFUSDT","STMXUSDT","UXLINKUSDT","BSWUSDT","NEIROETHUSDT","VIDTUSDT","TROYUSDT","BAKEUSDT","AMBUSDT","MEMEFIUSDT","NULSUSDT","HIFIUSDT","LEVERUSDT","XEMUSDT","STRAXUSDT","COMBOUSDT"];
    let movers=[],symbols=[],currentIndex=0;

    const delay=ms=>new Promise(r=>setTimeout(r,ms));
    const updateStatus=msg=>document.getElementById("status").innerHTML=msg;

    // 🧭 Market Sentiment
    async function fetchMarketSentiment(){
      const res=await fetch(`${API_URL}/fapi/v1/ticker/24hr`);
      const data=await res.json();
      const filtered=data.filter(d=>d.symbol.endsWith("USDT")&&!blacklist.includes(d.symbol));
      const green=filtered.filter(d=>parseFloat(d.priceChangePercent)>0).length;
      const red=filtered.filter(d=>parseFloat(d.priceChangePercent)<0).length;
      const total=green+red;
      const bullPct=((green/total)*100).toFixed(1);
      const bearPct=((red/total)*100).toFixed(1);
      document.getElementById("sentiment").innerHTML=
        `📈 <span class="bull">Green: ${green}</span> | 📉 <span class="bear">Red: ${red}</span> | 🧭 <span class="bull">${bullPct}% Bullish</span> / <span class="bear">${bearPct}% Bearish</span>`;
      return data;
    }

    // ✅ Fetch top movers (≥ +3%)
    async function fetchTopMovers(){
      updateStatus("📊 Updating 24h data...");
      const data=await fetchMarketSentiment();
      movers=data.filter(d=>d.symbol.endsWith("USDT")&&!blacklist.includes(d.symbol)&&parseFloat(d.priceChangePercent)>=3)
                 .map(d=>({symbol:d.symbol,price:+d.lastPrice,change:+d.priceChangePercent}));
      symbols=movers.map(m=>m.symbol);
      updateStatus(`✅ Loaded ${symbols.length} bullish movers.`);
    }

    async function getKlines(symbol,interval){
      const res=await fetch(`${API_URL}/fapi/v1/klines?symbol=${symbol}&interval=${interval}&limit=100`);
      const data=await res.json();
      return data.map(k=>+k[4]);
    }

    function calculateRSI(closes,period=RSI_PERIOD){
      let gains=0,losses=0;
      for(let i=1;i<period;i++){const diff=closes[i]-closes[i-1];diff>=0?gains+=diff:losses-=diff;}
      let avgGain=gains/period,avgLoss=losses/period;const rsiArr=[];
      for(let i=period;i<closes.length;i++){
        const diff=closes[i]-closes[i-1],gain=diff>0?diff:0,loss=diff<0?-diff:0;
        avgGain=(avgGain*(period-1)+gain)/period;avgLoss=(avgLoss*(period-1)+loss)/period;
        const rs=avgLoss===0?100:avgGain/avgLoss;rsiArr.push(100-100/(1+rs));
      }return rsiArr;
    }

    function detectZone(rsi){
      const recent=rsi.slice(-RSI_PERIOD),high=Math.max(...recent),low=Math.min(...recent);
      const diff=+(high-low).toFixed(2);const dir=recent.at(-1)>recent[0]?"pump":recent.at(-1)<recent[0]?"dump":"neutral";
      if(dir==="pump"&&diff>=30)return{zone:"MAX ZONE PUMP",diff};
      if(dir==="dump"&&diff>=30)return{zone:"MAX ZONE DUMP",diff};
      return null;
    }

    async function analyzeSymbol(symbol,interval){
      try{
        const closes=await getKlines(symbol,interval),rsi=calculateRSI(closes),res=detectZone(rsi);
        if(!res)return null;
        const t=movers.find(m=>m.symbol===symbol),time=new Date().toLocaleTimeString();
        return{symbol,zone:res.zone,diff:res.diff,price:t?.price?.toFixed(4)??"—",change:t?.change?.toFixed(2)??"0.00",time};
      }catch{return null;}
    }

    async function scan(tf,interval,activeMap){
      if(symbols.length===0)return;
      const batch=symbols.slice(currentIndex,currentIndex+BATCH_SIZE);
      currentIndex=(currentIndex+BATCH_SIZE)%symbols.length;
      updateStatus(`🔍 ${tf} scanning ${batch.length}/${symbols.length} pairs...`);
      const results=[];
      for(const s of batch){const r=await analyzeSymbol(s,interval);if(r)results.push(r);await delay(MIN_DELAY+Math.random()*(MAX_DELAY-MIN_DELAY));}
      const pump=document.getElementById(`pump-${tf}`),dump=document.getElementById(`dump-${tf}`);
      results.forEach(r=>{
        if(activeMap[r.symbol])return;
        const list=r.zone.includes("PUMP")?pump:dump;
        const color=r.zone.includes("PUMP")?"#22c55e":"#ef4444";
        const item=document.createElement("li");
        item.innerHTML=`<div><span class="symbol">${r.symbol}</span> → ${r.zone}
        <span class="meta">| 💰 ${r.price} | <span style="color:${color};">${r.change}%</span> | Δ ${r.diff} | 🕒 ${r.time}</span></div>`;
        list.prepend(item);
        activeMap[r.symbol]=item;
        while(list.children.length>MAX_ITEMS)list.removeChild(list.lastChild);
      });
      document.getElementById("last-update").textContent="Last updated: "+new Date().toLocaleTimeString();
    }

    async function run(){
      await fetchTopMovers();
      scan("15m","15m",activeSignals15m);
      scan("1d","1d",activeSignals1d);
      setInterval(()=>scan("15m","15m",activeSignals15m),INTERVAL_15M);
      setInterval(()=>scan("1d","1d",activeSignals1d),INTERVAL_1D);
      setInterval(fetchTopMovers,30000); // 24h data refresh
    }
    run();

    // 🟢 live 24h % updater
    setInterval(()=>{
      [...Object.entries({...activeSignals15m,...activeSignals1d})].forEach(([sym,el])=>{
        const t=movers.find(m=>m.symbol===sym);if(!t)return;
        const meta=el.querySelector(".meta");if(!meta)return;
        const color=t.change>=0?"#22c55e":"#ef4444";
        meta.innerHTML=meta.innerHTML.replace(/\|\s*💰.*?\|\s*<span style="color:[^"]+;">.*?<\/span>/,
          `| 💰 ${t.price.toFixed(4)} | <span style="color:${color};">${t.change.toFixed(2)}%</span>`);
      });
    },30000);
  </script>
</body>
</html>
