<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Binance Futures EMA14 > EMA70 > EMA200 Detector</title>
  <style>
    body { font-family: Arial; background: #0b0b0b; color: #f1f1f1; }
    h2 { color: #00ffae; }
    button { padding: 10px 20px; margin: 10px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #333; padding: 6px; text-align: center; }
    .bullish { color: #00ff66; }
    .neutral { color: #ccc; }
  </style>
</head>
<body>
  <h2>Binance Futures EMA14 > EMA70 > EMA200 Detector</h2>
  <p>Timeframe: 15m | Safe rate: 1 req/sec | Candles: 200</p>

  <button onclick="startScan()">Start Scan</button>
  <p id="progress"></p>
  <p id="greenCount"></p>

  <table id="results">
    <thead>
      <tr>
        <th>Pair</th>
        <th>EMA14</th>
        <th>EMA70</th>
        <th>EMA200</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_BASE = "https://fapi.binance.com";

    async function fetchSymbols() {
      const res = await fetch(`${API_BASE}/fapi/v1/exchangeInfo`);
      const data = await res.json();
      return data.symbols
        .filter(s => s.contractType === "PERPETUAL" && s.quoteAsset === "USDT")
        .map(s => s.symbol);
    }

    async function fetch24h(symbol) {
      const res = await fetch(`${API_BASE}/fapi/v1/ticker/24hr?symbol=${symbol}`);
      return await res.json();
    }

    function calcEMA(values, period) {
      const k = 2 / (period + 1);
      let ema = values[0];
      for (let i = 1; i < values.length; i++) {
        ema = values[i] * k + ema * (1 - k);
      }
      return ema;
    }

    async function fetchCandles(symbol) {
      const url = `${API_BASE}/fapi/v1/klines?symbol=${symbol}&interval=15m&limit=200`;
      const res = await fetch(url);
      const data = await res.json();
      return data.map(c => parseFloat(c[4])); // close prices
    }

    async function startScan() {
      document.querySelector("#results tbody").innerHTML = "";
      document.querySelector("#progress").textContent = "Loading symbols...";
      document.querySelector("#greenCount").textContent = "";

      const symbols = await fetchSymbols();
      let greenCount = 0;
      let scanned = 0;

      for (const symbol of symbols) {
        scanned++;
        document.querySelector("#progress").textContent =
          `Scanning ${scanned}/${symbols.length} - ${symbol}`;

        const info = await fetch24h(symbol);
        const change = parseFloat(info.priceChangePercent);
        if (change > 0) greenCount++;

        document.querySelector("#greenCount").textContent =
          `✅ Green 24h Pairs: ${greenCount}/${symbols.length}`;

        if (change > 0) {
          const closes = await fetchCandles(symbol);
          const ema14 = calcEMA(closes, 14);
          const ema70 = calcEMA(closes, 70);
          const ema200 = calcEMA(closes, 200);

          let status = "Neutral";
          let color = "neutral";
          if (ema14 > ema70 && ema70 > ema200) {
            status = "Bullish";
            color = "bullish";
          }

          const row = `
            <tr class="${color}">
              <td>${symbol}</td>
              <td>${ema14.toFixed(2)}</td>
              <td>${ema70.toFixed(2)}</td>
              <td>${ema200.toFixed(2)}</td>
              <td>${status}</td>
            </tr>`;
          document.querySelector("#results tbody").insertAdjacentHTML("beforeend", row);
        }

        await new Promise(r => setTimeout(r, 1000)); // Safe 1 req/sec
      }

      document.querySelector("#progress").textContent =
        `✅ Scan complete (${scanned} pairs scanned).`;
    }
  </script>
</body>
</html>
